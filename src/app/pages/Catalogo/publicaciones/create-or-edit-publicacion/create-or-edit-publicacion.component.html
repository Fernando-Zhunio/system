<div>
    <div *ngIf="!publication_current" class="mb-3">
        <h2 class="font-facebook font-3xl">Publicaciones</h2>
        <form [formGroup]="formName" (ngSubmit)="createPulicationName()">
            <mat-form-field appearance="fill" class="d-block">
                <mat-label>Ingrese el nombre de la publicacion</mat-label>
                <input matInput placeholder="pat@example.com" formControlName="name" required>
                <mat-error *ngIf="formName.invalid">Nombre Requerido</mat-error>
            </mat-form-field>
            <button mat-raised-button type="submit" [disabled]="formName.invalid || publication_current" color="accent">Guardar</button>
        </form>
    </div>
    <div *ngIf="publication_current">
        <!-- <div> -->
        <div>
            <h3>Publicacion # {{publication_current?.id}}</h3>
            <h2 *ngIf="publication_current">
                {{publication_current.name}}
                <button mat-mini-fab color="primary"><mat-icon>create</mat-icon></button>
            </h2>
        </div>
        <div #formMain [formGroup]="formPublication" (ngSubmit)="publicationNow()" class="row">
            <div class="col-md-6">
                <div>
                    <div>
                        <div class="font-3xl font-facebook mb-3">Cuentas de mercado libre</div>
                        <mat-form-field class="w-100">
                            <mat-label>Selecciones Empresas</mat-label>
                            <mat-select [formControl]="empresas" multiple>
                                <mat-option *ngFor="let ml_account of ml_accounts" [value]="ml_account.id">
                                    {{ml_account.user_name}}</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <div>
                        <div class="font-3xl font-facebook mb-3">Publicacion</div>
                        <div class="row">
                            <mat-form-field class="col-12" appearance="fill">
                                <mat-label>Titulo</mat-label>
                                <!-- categorias pasando por backend -->
                                <input matInput formControlName="title" (keyup)="predictorMl($event)" required>

                                <!-- categorias directo a mercado libre -->
                                <!-- <input matInput formControlName="title" (keyup)="alternativePredictor($event)" required> -->

                            </mat-form-field>
                            <div>
                                <div class="font-facebook col-12">Seleccione una categoria</div>
                                <!-- <mat-selection-list #options [multiple]="false">
                                    <mat-list-option *ngFor="let option of optionsTitle">
                                        {{option.category_name}}
                                    </mat-list-option>
                                </mat-selection-list> -->
                                <div class="col-12">
                                    <div *ngIf="isLoadCategory">
                                        <mat-spinner [diameter]="50">
                                            Cargando categorias espere
                                        </mat-spinner>
                                    </div>
                                    <div *ngIf="optionsTitle.length < 1 && !isLoadCategory" class="text-danger">
                                        Con este titulo no se encontro categorias
                                    </div>
                                    <mat-radio-group formControlName="category" *ngIf="!isLoadCategory" aria-label="Select an option">
                                        <mat-radio-button (change)="getAttributes(option.category_id,option.category_name)" class="mx-1" *ngFor="let option of optionsTitle" [value]="option.category_id"> {{option.category_name}}</mat-radio-button>
                                        <!-- <mat-radio-button value="2">Option 2</mat-radio-button> -->
                                    </mat-radio-group>

                                </div>
                            </div>
                            <mat-form-field class="col-12">
                                <mat-label>Descripcion</mat-label>
                                <textarea required formControlName="description" matInput rows="4"></textarea>
                            </mat-form-field>

                            <mat-form-field class="col-md-4" appearance="fill">
                                <mat-label>Cantidad</mat-label>
                                <input type="number" formControlName="qty" matInput required>
                                <!-- <mat-error *ngIf="formName.invalid"></mat-error> -->
                            </mat-form-field>

                            <mat-form-field class="col-md-4" appearance="fill">
                                <mat-label>Precio</mat-label>
                                <input type="number" formControlName="price" matInput required>
                                <!-- <mat-error *ngIf="formName.invalid"></mat-error> -->
                            </mat-form-field>

                            <mat-form-field class="col-md-4" appearance="fill">
                                <mat-label>Selecciones un tipo</mat-label>
                                <mat-select formControlName="type">
                                    <mat-option *ngFor="let key of keysListingTypes()" [value]="key">
                                        {{listing_types[key]}}</mat-option>
                                </mat-select>
                                <!-- <mat-error *ngIf="formName.invalid"></mat-error> -->
                            </mat-form-field>

                            <div class="w-100 border rounded p-3 mb-3">
                                <div class="mb-2">Imagenes</div>
                                <ngx-file-drop contentClassName="h-100" dropZoneClassName="border-dot" accept=".png,.jpeg,.jpg" dropZoneLabel="Drop files here" (onFileDrop)="dropped($event)" (onFileOver)="fileOver($event)" (onFileLeave)="fileLeave($event)">
                                    <ng-template ngx-file-drop-content-tmp let-openFileSelector="openFileSelector">
                                        <div class="row m-0 p-3 w-100">
                                            <div class=" col-12 d-flex justify-content-center align-items-center">
                                                Da click en boton o arratra para subirlo
                                                <button type="button" mat-raised-button (click)="openFileSelector()">Browse Files</button>
                                            </div>
                                            <small *ngIf="arrayImagen.length > 0" class="ml-2 my-2 w-100">Arrastre para
                                                cambiar la imagen principal</small>
                                            <div class=" grid-imagen" cdkDropList cdkDropListOrientation="horizontal" (cdkDropListDropped)="drop($event)">
                                                <div *ngFor="let item of arrayImagen; let i=index" cdkDrag>
                                                    <div class="position-relative">
                                                        <button mat-icon-button color="warn" (click)="removeImage(i)" class="btn-delete-imagen">
                                                            <mat-icon>close</mat-icon>
                                                        </button>
                                                        <span class="badge badge-pill badge-success position-absolute m-2" *ngIf="i==0">Imagen principal</span>
                                                        <img [src]="item.base64" alt="" class="w-100 rounded-lg" [ngClass]="i==0?'imagen-main-shadow':'imagen-shadow'">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </ng-template>
                                </ngx-file-drop>
                                <!-- <div class="upload-table">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Nombre</th>
                                                <th>Tama√±o</th>
                                                <th>Tipo</th>
                                                <th>Acciones</th>
                                            </tr>
                                        </thead>
                                        <tbody class="upload-name-style">
                                            <tr *ngFor="let item of arrayImagen; let i=index">
                                                <td><strong>{{ item.file.name }}</strong></td>
                                                <td><strong>{{ item.file.size/1024/1024 | number:'.1' }}mb</strong></td>
                                                <td>{{item.file.type}}</td>
                                                <td><button color="warn" mat-icon-button (click)="removeImage(i)">
                                                        <mat-icon>remove</mat-icon>
                                                    </button></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div> -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6" [ngStyle]="{'height': alturaAttribute}" style="overflow-y: auto;">
                <div></div>
                <div class="font-3xl font-facebook mb-3">Atributos</div>
                <div class="" formArrayName="attribute">
                    <!-- <div *ngFor="let attribute of attributes"> -->
                    <div *ngFor="let attribute_ of attributes; let i = index">
                        <mat-label class="d-block">{{attribute_.name}}</mat-label>
                        <div class="row">
                            <mat-form-field *ngIf="attribute_.values" class="col-md-6" appearance="fill">
                                <mat-label>Seleccionar</mat-label>
                                <!-- <mat-select [required]="attribute.tags.catalog_required"> -->
                                <mat-select [required]="attribute_.tags.catalog_required" [formControlName]="'attribute_suggest_'+attribute_.id">
                                    <mat-option *ngFor="let item of attribute_.values" [value]="item.id">
                                        {{item.name}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                            <mat-form-field [ngClass]="attribute_.values?'col-md-6':'col-md-12'" appearance="fill">
                                <mat-label>Ingresa un valor</mat-label>
                                <!-- <input matInput [formArrayName]="'attribute_manually_'+attribute.id" [required]="attribute.tags.catalog_required"> -->
                                <input matInput [formControlName]="'attribute_manually_'+attribute_.id" [required]="attribute_.tags.catalog_required">
                                <!-- <mat-error *ngIf="formName.invalid"></mat-error> -->
                            </mat-form-field>
                        </div>
                    </div>
                </div>
            </div>
            <button type="submit" [disabled]="formPublication.invalid || formPublication.controls['attribute'].invalid" mat-raised-button color="accent">Guardar</button>
        </div>
    </div>
</div>