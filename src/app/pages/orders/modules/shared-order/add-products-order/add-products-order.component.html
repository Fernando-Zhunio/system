<div class="mt-3 ">
  <h3 class="font-3xl font-weight-bold">Productos</h3>
  <div>
    <div>
      <div *ngxPermissionsOnly="permissionsProducts.create" [formGroup]="form" class="product-item d-md-flex d-block card-body">
        <div *ngIf="!isCancelled" >
          <div>Producto *: <span class="text-dark">{{form.get('product')?.value}}</span>
            <button mat-mini-fab  (click)="isOpenSearchProducts = !isOpenSearchProducts">
              <mat-icon>search</mat-icon>
            </button>    
          </div>
          <div class="d-flex align-items-end">
            <!-- <mat-form-field appearance="fill">
              <input readonly matInput formControlName="product" placeholder="Producto">
              <button class="bg-gray-200" mat-icon-button matSuffix (click)="isOpenSearchProducts = !isOpenSearchProducts">
                <mat-icon>search</mat-icon>
              </button>
            </mat-form-field> -->
            <!-- <mat-form-field appearance="fill"> -->
              <div>
                <small class="text-muted d-block">Precio *:</small>
                <input min="0" class="input-price input-product"  formControlName="price" type="number" placeholder="Precio"></div>
              <!-- <span matPrefix>$&nbsp;</span>
            </mat-form-field> -->
            <!-- <mat-form-field appearance="fill"> -->
              <div>
                <small class="text-muted d-block">Cantidad *:</small>
                <input min="1" class="input-quantity input-product" type="number" formControlName="quantity" placeholder="Cantidad">
              </div>
            <!-- </mat-form-field> -->
            <!-- <mat-form-field appearance="fill"> -->
              <div>
                <small class="text-muted d-block">Descripci贸n:</small>
                <input  class="input-product" formControlName="description" placeholder="Descripci贸n">
              </div>
            <!-- </mat-form-field> -->
            <div class="pt-md-2 col">
              <button [disabled]="form.invalid || isLoading || isEditingItem" color="primary" mat-raised-button
               (click)="createOrEditItemOrder()">Agregar producto</button>
            </div>
            
          </div>
        </div>
      </div>
      <ng-container *ngxPermissionsOnly="permissionsProducts.edit">
        <div  *ngIf="isEditingItem && !isCancelled" class="editing-item product-item  d-md-flex d-block card-body">
          <div>
            <h4 class="parpadeo font-weight-bold">Editando</h4>
            <div [formGroup]="formEdit" class="row">
              <mat-form-field appearance="fill" class="col-md-5">
                <input matInput readonly formControlName="product" placeholder="Producto">
                <button class="bg-gray-200" mat-icon-button matSuffix (click)="isOpenSearchProducts = !isOpenSearchProducts">
                  <mat-icon>search</mat-icon>
                </button>
              </mat-form-field>
              <mat-form-field appearance="fill" class="col-md-2">
                <input matInput formControlName="price" type="number" placeholder="Precio">
                <span matPrefix>$&nbsp;</span>
              </mat-form-field>
              <mat-form-field appearance="fill" class="col-md-2">
                <input matInput formControlName="quantity" type="number" placeholder="Cantidad">
              </mat-form-field>
              <mat-form-field appearance="fill" class="col-md-2">
                <textarea matInput type="number" formControlName="description" placeholder="Descripci贸n"></textarea>
              </mat-form-field>
              <div>
                <button [disabled]="form.invalid || isLoading" color="primary" mat-raised-button
                  (click)="createOrEditItemOrder()">Actualizar</button>
                  <button [disabled]="isLoading" color="warn" mat-raised-button
                  (click)="disabledEditingItemOrder()">Cancelar</button>
              </div>
            </div>
          </div>
        </div>
      </ng-container>
      <hr>
      <h4 class="font-2xl font-weight-bold">Lista de productos</h4>
      <div>
        <div data>
          <table class="table table-responsive d-md-table table-borderless table-striped">
            <thead class="text-primary">
              <tr>
                <th>Imagen</th>
                <th>Producto</th>
                <th>Descripci贸n</th>
                <th>Precio</th>
                <th>Cantidad</th>
                <th>Acciones</th>
            </thead>
            <tbody>
              <tr *ngFor="let item of items | keyvalue">
                <td class="py-0">
                  <img class="img-product-item" mat-list-avatar [src]="item.value.product?.image || 'assets/img/img_default_null.jpg'"
                    alt="imagen producto">
                </td>
                <td>
                  <div>{{item.value.product?.name}}</div>
                  <span class="text-muted">{{item.value.product?.code}}</span> 
                </td>
                <td>{{item.value?.description}}</td>
                <td class="text-muted">${{item.value.price}}</td>
                <td class="text-muted">{{item.value.quantity}}</td>
                <td>
                    <button *ngxPermissionsOnly="permissionsProducts.edit" [disabled]="isCancelled" mat-icon-button color="primary" (click)="enabledEditingItemOrder(item.key)"><mat-icon>edit</mat-icon></button>
                    <button *ngxPermissionsOnly="permissionsProducts.destroy" [disabled]="isCancelled" mat-icon-button color="warn"  (click)="deleteItemOrder(order.id, item.key)"><mat-icon>delete</mat-icon></button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<div *ngIf="!isCancelled" [ngClass]="{'close-search-product': !isOpenSearchProducts}" class="search-product col-md-6 col-9">
  <div class="position-fixed"><button (click)="isOpenSearchProducts = !isOpenSearchProducts" mat-mini-fab class="close-search-product-btn bg-gray-300"><mat-icon>close</mat-icon></button></div>
  <div>
    <div>
      <app-search [url]="urlProducts" placeholder="Buscador de productos" (data)="getDataProducts($event)">
        <mat-selection-list data [multiple]="false" (selectionChange)="selectedProduct($event)">
          <mat-list-option [value]="product.key" *ngFor="let product of products | keyvalue">
            <img mat-list-avatar [src]="product.value?.image || 'assets/img/img_default_null.jpg'" alt="imagen producto">
            <div mat-line>{{product.value.name}}</div>
            <div mat-line>{{product.value.code}}</div>
            <mat-divider></mat-divider>
          </mat-list-option>
        </mat-selection-list>
      </app-search>
    </div>
  </div>
</div>
