<app-search-template-table
  [title]="'Promociones'"
  (data)="getData($event)"
  placeholder="Buscador de promociones"
  [url$]="url">
  <ng-container menuBar>
    <mat-chip-list *ngxPermissionsOnly="permissions.create">
      <mat-chip [routerLink]="['./create']" class="mat-orange ml-2">
        <mat-icon>add</mat-icon>
        promoción
      </mat-chip>
      <mat-chip (click)="isOpenFile = !isOpenFile" selected color="primary" class="ml-2">
        <i class="fas fa-file-excel mr-1"></i>
        Importar por excel
      </mat-chip>
    </mat-chip-list>
  </ng-container>
  <ng-container subheader>
    <div class="attach-file mb-4 position-relative" *ngIf="isOpenFile">
      <button mat-icon-button class="btn-close" color="warn" (click)="isOpenFile = false">
        <mat-icon>close</mat-icon>
      </button>
      <div class="container">
        <file-pond #myPond className="m-0 shadow" [options]="pondOptions"></file-pond>
      </div>
    </div>
  </ng-container>
  <ng-container table>
    <table multiTemplateDataRows class="w-100" mat-table #table [dataSource]="dataSource">
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef>ID</th>
        <td mat-cell *matCellDef="let row">{{ row.id }}</td>
      </ng-container>
      <ng-container matColumnDef="title">
        <th mat-header-cell *matHeaderCellDef>Titulo</th>
        <td mat-cell *matCellDef="let row">{{ row.title }}</td>
      </ng-container>
      <ng-container matColumnDef="products">
        <th mat-header-cell *matHeaderCellDef>Productos</th>
        <td mat-cell style="max-width: 300px;" *matCellDef="let row">
          <mat-list dense>
            <mat-list-item *ngFor="let product of row.products">
              <img matListAvatar width="50" [src]="product.image || 'assets/img/img_default_null.jpg'" />
              <div style="white-space: normal;" mat-line><span class="text-primary mr-1">{{product.code}}</span>{{ product.name }}</div>
              <div mat-line>
                Cantidad:
                <span class="text-primary">{{ product.pivot.quantity }}</span>
              </div>
            </mat-list-item>
          </mat-list>
        </td>
      </ng-container>
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Estado</th>
        <td mat-cell *matCellDef="let row">
          <span [class]="row.status" class="badge-fz">{{ row.status | translatefz }}</span>
        </td>
      </ng-container>
      <ng-container matColumnDef="duration_type">
        <th mat-header-cell *matHeaderCellDef>Tipo duración</th>
        <td mat-cell *matCellDef="let row">
          <span [class]="row.duration_type" class="badge-fz">
            <i [hidden]="row.duration_type === 'undefined'" class="fas fa-calendar-alt"></i>
            {{ row.duration_type | translatefz }}
          </span>
        </td>
      </ng-container>
      <ng-container matColumnDef="price">
        <th mat-header-cell *matHeaderCellDef>Precio</th>
        <td mat-cell *matCellDef="let row">{{ row.price_formated | currency }}</td>
      </ng-container>
      <ng-container matColumnDef="created_at">
        <th mat-header-cell *matHeaderCellDef>Creado</th>
        <td mat-cell *matCellDef="let row">{{ row.created_at | date: "medium" }}</td>
      </ng-container>
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Acciones</th>
        <td mat-cell *matCellDef="let row">
          <button
            *ngxPermissionsOnly="permissions.edit"
            [routerLink]="['./', row.id, 'edit']"
            mat-icon-button
            color="primary"
            mat-icon-button>
            <i class="fa-regular fa-pen-to-square"></i>
          </button>
          <!-- <button
            *ngxPermissionsOnly="permissions.create"
            mat-icon-button
            color="accent"
            mat-icon-button
            (click)="openDetails(row.id)"
    
            >
            <mat-icon>info</mat-icon>
          </button> -->
          <button *ngxPermissionsOnly="permissions.destroy" (click)="deleteData(row.id)" mat-icon-button color="warn">
            <i class="fa-solid fa-trash"></i>
          </button>
        </td>
      </ng-container>
      <!-- <ng-container matColumnDef="expandedDetail">
        <td mat-cell *matCellDef="let element" [attr.colspan]="columnsToDisplay.length">
          <mat-list-item *ngIf="element.products?.length < 1; else TemplateIsLoading">
            <mat-icon matListIcon>info</mat-icon>
            <h4 matLine>Esta promoción no tiene productos asociados</h4>
          </mat-list-item>
          <ng-template #TemplateIsLoading>
            <mat-list dense>
              <ng-container *ngIf="element?.note">
                <mat-list-item>
                  <h2 class="font-weight-bold m-0">Descripción</h2>
                </mat-list-item>
                <mat-list-item class="h-auto">
                  <div style="max-width: 350px">{{ element?.note }}</div>
                </mat-list-item>
              </ng-container>
              <mat-list-item>
                <h2 class="font-weight-bold m-0 mt-2">Productos</h2>
              </mat-list-item>
              <mat-list-item *ngFor="let product of element.products">
                <img matListAvatar width="50" [src]="product.image || 'assets/img/img_default_null.jpg'" />
                <div mat-line>{{ product.name }}</div>
                <div mat-line>
                  Cantidad:
                  <span class="text-primary">{{ product.pivot.quantity }}</span>
                </div>
              </mat-list-item>
            </mat-list>
          </ng-template>
        </td>
      </ng-container> -->
      <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>
      <tr mat-row *matRowDef="let row; columns: columnsToDisplay"></tr>
      <!-- <tr mat-row *matRowDef="let element; columns: ['expandedDetail']" class="example-detail-row"></tr> -->
    </table>
  </ng-container>
</app-search-template-table>

<div *ngIf="campaign" class="campaign">
  <div *ngIf="campaign?.duration_type === 'date_range'">
    De :
    <span class="text-success">{{ campaign.start_date | date: "medium" }}</span>
    <br />
    Hasta :
    <span class="text-danger">{{ campaign.end_date | date: "medium" }}</span>
  </div>
  <div>
    Campaña :
    <span class="text-success">#{{ campaign.id }} {{ campaign.title }}</span>
  </div>
</div>
