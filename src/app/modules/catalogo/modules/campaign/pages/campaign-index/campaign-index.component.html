<app-search-template-table
  [title]="'Campañas'"
  (data)="getData($event)"
  placeholder="Buscador de campañas"
  [url$]="'catalogs/campaigns'">
  <ng-container menuBar>
    <mat-chip-list *ngxPermissionsOnly="permissions.create">
      <mat-chip [routerLink]="['./create']" routerLinkActive="router-link-active" class="mat-orange ml-2">
        <mat-icon>add</mat-icon>
        Campaña
      </mat-chip>
    </mat-chip-list>
  </ng-container>

  <ng-container table>
    <table class="w-100" mat-table #table [dataSource]="dataSource">
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef> ID </th>
        <td mat-cell *matCellDef="let row"> {{row.id}} </td>
      </ng-container>
      <ng-container matColumnDef="title">
        <th mat-header-cell *matHeaderCellDef> Titulo </th>
        <td mat-cell *matCellDef="let row"> {{row.title}} </td>
      </ng-container>
      <ng-container matColumnDef="description">
        <th mat-header-cell *matHeaderCellDef> Descripción </th>
        <td mat-cell *matCellDef="let row"> 
          <div #toggle class="text-truncate" (click)="toggle.classList.toggle('text-truncate')" >
            <span>{{row.description}}</span>
          </div>
        </td>
      </ng-container>
      <ng-container matColumnDef="duration_type">
        <th mat-header-cell *matHeaderCellDef> Tipo duración </th>
        <td mat-cell *matCellDef="let row"><span [class]="row.duration_type" class="badge-fz "><i [hidden]="row.duration_type === 'undefined'" class="fas fa-calendar-alt"></i>  {{row.duration_type | translatefz}}</span> </td>
      </ng-container>
      <ng-container matColumnDef="start_date">
        <th mat-header-cell *matHeaderCellDef> Inicio </th>
        <td mat-cell *matCellDef="let row"> {{row.start_date | date:'medium'}} </td>
      </ng-container>
      <ng-container matColumnDef="end_date">
        <th mat-header-cell *matHeaderCellDef> Fin </th>
        <td mat-cell *matCellDef="let row"> {{row.end_date | date:'medium'}} </td>
      </ng-container>
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef> Estado </th>
        <td mat-cell *matCellDef="let row"> <span [class]="row.status" class="badge-fz">{{row.status | translatefz}}</span> </td>
      </ng-container>
      <ng-container matColumnDef="created_at">
        <th mat-header-cell *matHeaderCellDef> Creado </th>
        <td mat-cell *matCellDef="let row"> {{row.created | date}} </td>
      </ng-container>
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef> Acciones </th>
        <td mat-cell *matCellDef="let row"> 
          <button class="btn-icon-edit" matRipple *ngxPermissionsOnly="permissions.edit" [routerLink]="['./', row.id, 'edit']">
            <i class="far fa-edit"></i>
          </button>
          <button matRipple class="btn-icon-delete" *ngxPermissionsOnly="permissions.destroy" (click)="deleteData(row.id)">
            <i class="far fa-trash-alt"></i>
          </button>
          <button class="btn-icon-delete text-info"  [matBadge]="row.promotions_count || 0" matBadgeOverlap="false" matRipple data-toggle="tooltip" data-placement="top" title="Promociones" *ngxPermissionsOnly="permissionsPromotions.index" [routerLink]="['./', row.id, 'promotions']" >
            <i class="fa-tags fas"></i>
          </button>
        </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>
      <tr mat-row *matRowDef="let row; columns: columnsToDisplay;"></tr>
    </table>


    <!-- <mat-card class="card border-0" *ngFor="let campaign of data | keyvalue">
      <mat-card-header>
        <mat-card-title>{{ campaign.value.title }}</mat-card-title>
        <mat-card-subtitle>{{ campaign.value.created_at | date: "medium" }}</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <p>{{ campaign.value.description }}</p>
        <div>
          <small>Detalles</small>
          <ul class="list">
            <li>Duración: {{ campaign.value.duration_type | translatefz }}</li>
            <li>Estado: <span [class]="campaign.value.status">{{ campaign.value.status | translatefz }}</span></li>
          </ul>
        </div>
        <div *ngIf="campaign.value.duration_type == 'date_range'">
          <small>Inicio y Fin</small>
          <ul class="list">
            <li>Inicio: {{ campaign.value.start_date | date:'medium'}}</li>
            <li>Fin: {{ campaign.value.end_date | date:'medium' }}</li>
          </ul>
        </div>
        <div class="my-2">
          <button *ngxPermissionsOnly="permissions.edit" [routerLink]="['./', campaign.key, 'edit']" mat-icon-button color="primary">
            <mat-icon>edit</mat-icon>
          </button>
          <button *ngxPermissionsOnly="permissions.destroy" (click)="deleteData(campaign.key)" mat-icon-button color="warn">
            <mat-icon>delete</mat-icon>
          </button>
          <button class="rounded-fz" *ngxPermissionsOnly="permissions.index" [routerLink]="['./', campaign.key, 'promotions']" mat-stroked-button color="accent">
            <mat-icon>visibility</mat-icon>
            Promociones
          </button>
        </div>
      </mat-card-content>
    </mat-card> -->
  </ng-container>
</app-search-template-table>
