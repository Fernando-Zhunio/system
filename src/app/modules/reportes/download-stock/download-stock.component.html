<div class=" my-3 font-5xl">Descarga de reporte</div>

<mat-card >
  <div class="card-body pb-0">
    <ng-container *ngIf="mbaStatus">
      <div class="d-flex align-items-center mb-2">
        <span class="lead">Estado del servicio MBA:&nbsp;</span>
        <mat-chip-list>
          <mat-chip [ngClass]=" mbaStatus?.value == 'down'?'down':'up'">{{mbaStatus?.value == 'down'?'CAIDO':'EN LINEA'}} DESDE : {{mbaStatus.updated_at | amLocale:'es' | amTimeAgo}}
          </mat-chip>
        </mat-chip-list>
      </div>
      <div *ngIf="mbaStatus.value == 'down'" class="alert alert-warning">
        <strong>CUIDADO!</strong> los datos de stock no se han actualizado desde <b>{{mbaStatus.updated_at | amLocale:'es' | amTimeAgo}}</b>, lo
        cual significa que la información de este reporte no es fiable, úsela bajo su responsabilidad.
      </div>
      <!-- <ng-template #templateMbaUp>
        <small class="badge-success badge font-sm">Desde: {{mbaStatus.updated_at | amLocale:'es' | amTimeAgo}}</small>
      </ng-template> -->
    </ng-container>
  </div>
  <div class="row m-0 card-body pt-0">
    <div class="col-12 my-2">
      <input (keyup)="filterWarehouse()" [(ngModel)]="search" type="text"
        class="form-control input-facebook rounded-fz mb-2" placeholder="Buscador de bodegas">
    </div>
    <div class="col-12 col-md-6 border-right mb-lg-3">
      <div class="shadow-lg mr-2 rounded-fz card-body">
        <div class=" font-2xl mb-2">Bodegas <span class="badge bg-success">{{warehousesMap.size}}</span></div>
        <mat-selection-list [ngStyle]="{'filter': allWarehouse?'blur(3px)':'none'}" class="warehouse" [multiple]="false">
          <mat-list-option class="border-bottom" (click)="addWarehousesSelects(warehouse.value.id)" *ngFor="let warehouse of warehousesMap | keyvalue">
            <div class="warehouse-item">
              <span>{{warehouse.value.name}} <small>({{warehouse.value.code}})</small></span>
              <span><i class="fas fa-share-square text-primary"></i></span>
            </div>
          </mat-list-option>
        </mat-selection-list>
      </div>
    </div>
    <div class="col-md-6 col-12">
      <div class="shadow-lg ml-2 rounded-fz card-body" style="position: sticky;top: 20px;">
        <div class=" font-2xl">Bodegas seleccionadas</div>
        <mat-chip-list>
          <mat-chip class="bg-warning mt-3 text-white" [color]="'warn'">Total de bodegas seleccionadas:&nbsp;  <span class="badge badge-info">{{allWarehouse?'Todas':warehousesSelectsMap.size}}</span> </mat-chip>
        </mat-chip-list>
        <mat-selection-list [ngStyle]="{'filter': allWarehouse?'blur(3px)':'none'}"  [multiple]="false">
          <mat-list-option class="border-bottom" (click)="removeWarehousesSelects(warehouse.value.id)" *ngFor="let warehouse of warehousesSelectsMap | keyvalue">
            <div class="warehouse-item">
              <span>{{warehouse.value.name}} <small>({{warehouse.value.code}})</small></span>
              <span><i class="fas fa-share-square text-danger rotate-180"></i></span>
            </div>
          </mat-list-option>
        </mat-selection-list>
        <div class="my2">
          <mat-slide-toggle (change)="changeAllWarehouse($event)">Traer todas las Bodegas</mat-slide-toggle><br>
          <mat-slide-toggle [(ngModel)]="show_global_stock">Mostrar conteo global</mat-slide-toggle><br>
          <button class="my-3" (click)="saveInServer()" [disabled]="((warehousesSelectsMap.size < 1 && !allWarehouse  ) || isLoad)" mat-raised-button
            color="accent">Descargar reporte <mat-icon>save_alt</mat-icon></button>
        </div>
      </div>
    </div>
  </div>
</mat-card>
